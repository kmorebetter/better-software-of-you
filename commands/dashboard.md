---
description: Generate and open a unified HTML dashboard
allowed-tools: ["Bash", "Read", "Write"]
---

# Generate Dashboard

Generate the Software of You home dashboard. This is a **fixed-layout** dashboard — the same sections appear in the same order every time. You fill in the data, but do NOT change the structure.

## Step 0: Auto-Sync External Data

Before building the dashboard, ensure data is fresh. Follow the auto-sync procedure in CLAUDE.md — check `gmail_last_synced` and `calendar_last_synced` in `soy_meta`, and sync if stale (>15 min) or never synced. Do this silently.

## Step 1: Read the Design System

Read these files first:
- `${CLAUDE_PLUGIN_ROOT}/skills/dashboard-generation/references/template-base.html` — HTML skeleton
- `${CLAUDE_PLUGIN_ROOT}/skills/dashboard-generation/references/component-patterns.md` — component snippets
- `${CLAUDE_PLUGIN_ROOT}/skills/dashboard-generation/references/navigation-patterns.md` — nav bar patterns

## Step 2: Gather Data

Query `${CLAUDE_PLUGIN_ROOT}/data/soy.db`. Check installed modules first:
```sql
SELECT name FROM modules WHERE enabled = 1;
```

**Query generated views** (for navigation and contact linking):
```sql
SELECT entity_name, entity_id, filename, updated_at FROM generated_views
WHERE view_type = 'entity_page' ORDER BY updated_at DESC LIMIT 10;
```

**Always query:**
```sql
-- Contact stats
SELECT COUNT(*) as total, SUM(CASE WHEN status='active' THEN 1 ELSE 0 END) as active FROM contacts;

-- Recent contacts
SELECT id, name, company, email, status, updated_at FROM contacts
WHERE status = 'active' ORDER BY updated_at DESC LIMIT 8;

-- Recent activity
SELECT al.*, CASE al.entity_type
    WHEN 'contact' THEN (SELECT name FROM contacts WHERE id = al.entity_id)
    WHEN 'project' THEN (SELECT name FROM projects WHERE id = al.entity_id)
    ELSE al.entity_type || ' #' || al.entity_id
  END as entity_name
FROM activity_log al ORDER BY al.created_at DESC LIMIT 15;
```

**If CRM module installed:**
```sql
SELECT f.*, c.name as contact_name FROM follow_ups f
JOIN contacts c ON f.contact_id = c.id
WHERE f.status = 'pending' ORDER BY f.due_date ASC LIMIT 8;
```

**If Project Tracker installed:**
```sql
SELECT status, COUNT(*) as count FROM projects GROUP BY status;

SELECT p.id, p.name, p.status, p.priority, p.target_date, c.name as client_name
FROM projects p LEFT JOIN contacts c ON p.client_id = c.id
WHERE p.status IN ('active', 'planning') ORDER BY p.priority DESC, p.updated_at DESC;

SELECT status, COUNT(*) as count FROM tasks GROUP BY status;

SELECT t.title, t.due_date, p.name as project_name FROM tasks t
JOIN projects p ON t.project_id = p.id
WHERE t.due_date < date('now') AND t.status NOT IN ('done');
```

## Step 3: Generate HTML

Generate a self-contained HTML file. Follow this **exact layout structure**:

### Nav Bar (always)
Include the dashboard nav bar from `navigation-patterns.md` — shows "Dashboard" label + pills linking to generated entity pages.

### Header (always)
- Title: "Software of You"
- Subtitle: Generated date in human format
- Stat pills (right side): Contact count, Project count (if installed), Task count (if installed)

### Row 1: Two-column grid
- **Left: Active Projects** (if Project Tracker installed) — table with project name, client, status badge, target date. If no projects, show "Contacts" card instead.
- **Right: Task Overview** (if Project Tracker installed) — 4 grid boxes showing todo/in-progress/done/blocked counts. Below: overdue task warning if any. If no Project Tracker, show "Contacts" card.

### Row 2: Two-column grid
- **Left: Contacts** — list of recent contacts with name, company/role, email. If already shown in Row 1, show "Tags" or skip.
- **Right: Upcoming Follow-ups** (if CRM installed) — list with contact name, reason, due date. Overdue items highlighted in red. If no CRM, skip this card.

### Row 3: Full-width
- **Activity Timeline** — full-width card with recent activity entries, each showing an icon, action description, entity name, and relative timestamp.

### Footer
- "Generated by Software of You" with module names and count.

### Design Rules (non-negotiable)
- Use the template-base.html structure (Tailwind CDN, Lucide CDN, Inter font)
- Background: `bg-zinc-50`, cards: `bg-white rounded-xl shadow-sm border border-zinc-200 p-6`
- Status badges: green (active/done), blue (planning/in-progress), amber (pending), red (overdue/blocked), zinc (paused/inactive)
- Use Lucide icons: `users` for contacts, `folder`/`folder-open` for projects, `check-square` for tasks, `clock` for follow-ups, `activity` for timeline
- All data static in HTML — no JavaScript data fetching
- Responsive: `grid grid-cols-1 lg:grid-cols-2 gap-6`

If a section has no data, show an empty state with a subtle message and a suggestion command.

### Contact Name Linking

Anywhere a contact name appears (activity feed, follow-ups, project cards), check if that contact has a generated entity page in the `generated_views` query results. If so, render the name as a clickable link to that page. If not, render as plain text. Follow the pattern in `navigation-patterns.md`.

Write to `${CLAUDE_PLUGIN_ROOT}/output/dashboard.html`.

## Step 4: Register, Open

**Register the dashboard view:**
```sql
INSERT INTO generated_views (view_type, entity_type, entity_id, entity_name, filename)
VALUES ('dashboard', NULL, NULL, 'Dashboard', 'dashboard.html')
ON CONFLICT(filename) DO UPDATE SET updated_at = datetime('now');
```

Run: `open "${CLAUDE_PLUGIN_ROOT}/output/dashboard.html"`

Tell the user: "Dashboard updated and opened."
