<!-- Sidebar -->
<aside id="sidebar" class="sidebar">
  <div class="sidebar-header">
    <a href="dashboard.html" class="sidebar-logo">
      <i data-lucide="hexagon" class="w-4 h-4"></i>
      <span>Software of You</span>
    </a>
  </div>
  <nav class="sidebar-nav">
    <a href="dashboard.html" class="sidebar-item {{ 'active' if active_page == 'dashboard' }}">
      <i data-lucide="layout-dashboard" class="w-4 h-4"></i>
      Dashboard
    </a>

    {% if 'crm' in modules %}
    <div class="sidebar-section {{ 'open' if active_section == 'people' }}" id="section-people">
      <button class="sidebar-section-label" onclick="toggleSection('section-people')">
        <span>People</span>
        <i data-lucide="chevron-right" class="w-3.5 h-3.5 sidebar-chevron"></i>
      </button>
      <div class="sidebar-section-content">
        <a href="contacts.html" class="sidebar-item {{ 'active' if active_page == 'contacts' }}">
          <i data-lucide="users" class="w-4 h-4"></i>
          Contacts
          {% if nav_counts.contacts %}<span class="sidebar-badge">{{ nav_counts.contacts }}</span>{% endif %}
        </a>
        <a href="network-map.html" class="sidebar-item {{ 'active' if active_page == 'network' }}">
          <i data-lucide="share-2" class="w-4 h-4"></i>
          Network Map
        </a>
        {% if contact_pages %}
        <div class="sidebar-divider"></div>
        {% for cp in contact_pages %}
        {% if loop.index <= 10 %}
        <a href="{{ cp.filename }}" class="sidebar-entity {{ 'active' if active_entity_id == cp.entity_id }}">{{ cp.entity_name }}</a>
        {% else %}
        <a href="{{ cp.filename }}" class="sidebar-entity sidebar-entity-overflow {{ 'active' if active_entity_id == cp.entity_id }}">{{ cp.entity_name }}</a>
        {% endif %}
        {% endfor %}
        {% if contact_pages|length > 10 %}
        <button class="sidebar-show-all" onclick="showAllEntities('section-people')">Show all ({{ contact_pages|length }})</button>
        {% endif %}
        {% endif %}
      </div>
    </div>
    {% endif %}

    {% if project_pages %}
    <div class="sidebar-section {{ 'open' if active_section == 'projects' }}" id="section-projects">
      <button class="sidebar-section-label" onclick="toggleSection('section-projects')">
        <span>Projects</span>
        <i data-lucide="chevron-right" class="w-3.5 h-3.5 sidebar-chevron"></i>
      </button>
      <div class="sidebar-section-content">
        {% for pp in project_pages %}
        {% if loop.index <= 10 %}
        <a href="{{ pp.filename }}" class="sidebar-entity {{ 'active' if active_entity_id == pp.entity_id }}">{{ pp.entity_name }}</a>
        {% else %}
        <a href="{{ pp.filename }}" class="sidebar-entity sidebar-entity-overflow {{ 'active' if active_entity_id == pp.entity_id }}">{{ pp.entity_name }}</a>
        {% endif %}
        {% endfor %}
        {% if project_pages|length > 10 %}
        <button class="sidebar-show-all" onclick="showAllEntities('section-projects')">Show all ({{ project_pages|length }})</button>
        {% endif %}
      </div>
    </div>
    {% endif %}

    {% if 'gmail' in modules or 'calendar' in modules %}
    <div class="sidebar-section {{ 'open' if active_section == 'comms' }}" id="section-comms">
      <button class="sidebar-section-label" onclick="toggleSection('section-comms')">
        <span>Comms</span>
        <i data-lucide="chevron-right" class="w-3.5 h-3.5 sidebar-chevron"></i>
      </button>
      <div class="sidebar-section-content">
        {% if 'gmail' in modules %}
        <a href="email-hub.html" class="sidebar-item {{ 'active' if active_page == 'email' }}">
          <i data-lucide="mail" class="w-4 h-4"></i>
          Email
          {% if nav_counts.emails %}<span class="sidebar-badge">{{ nav_counts.emails }}</span>{% endif %}
        </a>
        {% endif %}
        {% if 'calendar' in modules %}
        <a href="week-view.html" class="sidebar-item {{ 'active' if active_page == 'calendar' }}">
          <i data-lucide="calendar" class="w-4 h-4"></i>
          Calendar
          {% if nav_counts.calendar %}<span class="sidebar-badge">{{ nav_counts.calendar }}</span>{% endif %}
        </a>
        {% endif %}
      </div>
    </div>
    {% endif %}

    {% set intel_modules = [] %}
    {% if 'conversation-intelligence' in modules %}{% set _ = intel_modules.append('conversations') %}{% endif %}
    {% if 'decision-log' in modules %}{% set _ = intel_modules.append('decisions') %}{% endif %}
    {% if 'journal' in modules %}{% set _ = intel_modules.append('journal') %}{% endif %}
    {% if 'notes' in modules %}{% set _ = intel_modules.append('notes') %}{% endif %}

    {% if intel_modules %}
    <div class="sidebar-section {{ 'open' if active_section == 'intelligence' }}" id="section-intelligence">
      <button class="sidebar-section-label" onclick="toggleSection('section-intelligence')">
        <span>Intelligence</span>
        <i data-lucide="chevron-right" class="w-3.5 h-3.5 sidebar-chevron"></i>
      </button>
      <div class="sidebar-section-content">
        {% if 'conversation-intelligence' in modules %}
        <a href="conversations.html" class="sidebar-item {{ 'active' if active_page == 'conversations' }}">
          <i data-lucide="message-square" class="w-4 h-4"></i>
          Conversations
        </a>
        {% endif %}
        {% if 'decision-log' in modules %}
        <a href="decision-journal.html" class="sidebar-item {{ 'active' if active_page == 'decisions' }}">
          <i data-lucide="git-branch" class="w-4 h-4"></i>
          Decisions
        </a>
        {% endif %}
        {% if 'journal' in modules %}
        <a href="journal.html" class="sidebar-item {{ 'active' if active_page == 'journal' }}">
          <i data-lucide="book-open" class="w-4 h-4"></i>
          Journal
        </a>
        {% endif %}
        {% if 'notes' in modules %}
        <a href="notes.html" class="sidebar-item {{ 'active' if active_page == 'notes' }}">
          <i data-lucide="sticky-note" class="w-4 h-4"></i>
          Notes
        </a>
        {% endif %}
      </div>
    </div>
    {% endif %}

    <div class="sidebar-section {{ 'open' if active_section == 'tools' }}" id="section-tools">
      <button class="sidebar-section-label" onclick="toggleSection('section-tools')">
        <span>Tools</span>
        <i data-lucide="chevron-right" class="w-3.5 h-3.5 sidebar-chevron"></i>
      </button>
      <div class="sidebar-section-content">
        <a href="weekly-review.html" class="sidebar-item {{ 'active' if active_page == 'weekly-review' }}">
          <i data-lucide="clipboard-list" class="w-4 h-4"></i>
          Weekly Review
        </a>
        <a href="nudges.html" class="sidebar-item {{ 'active' if active_page == 'nudges' }}">
          <i data-lucide="bell" class="w-4 h-4"></i>
          Nudges
          {% if nav_counts.urgent %}<span class="sidebar-badge sidebar-badge-alert">{{ nav_counts.urgent }}</span>{% endif %}
        </a>
        <a href="timeline.html" class="sidebar-item {{ 'active' if active_page == 'timeline' }}">
          <i data-lucide="clock" class="w-4 h-4"></i>
          Timeline
        </a>
        <a href="search.html" class="sidebar-item {{ 'active' if active_page == 'search' }}">
          <i data-lucide="search" class="w-4 h-4"></i>
          Search
        </a>
      </div>
    </div>
  </nav>

  {% if tip_text %}
  <div class="sidebar-tip-zone">
    <div class="sidebar-tip">
      <p class="sidebar-tip-label">Tip</p>
      <p class="sidebar-tip-text">{{ tip_text }}</p>
    </div>
  </div>
  {% endif %}
</aside>

<!-- Mobile hamburger toggle -->
<button id="sidebar-toggle" class="sidebar-mobile-toggle" onclick="toggleSidebar()">
  <i data-lucide="menu" class="w-5 h-5"></i>
</button>

<!-- Mobile backdrop -->
<div id="sidebar-backdrop" class="sidebar-backdrop" onclick="toggleSidebar()"></div>
